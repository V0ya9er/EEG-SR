# SR-EEG èœå•ç³»ç»Ÿé‡æ„è®¾è®¡æ–¹æ¡ˆ

## 1. ç°æœ‰é—®é¢˜åˆ†æ

### 1.1 å½“å‰èœå•ç»“æ„

```
ä¸»èœå•
â”œâ”€â”€ [1] å•æ¬¡å®éªŒ
â”œâ”€â”€ [2] LOSO å®éªŒ
â”œâ”€â”€ [3] æ‰¹é‡å®éªŒ
â”œâ”€â”€ [4] è‡ªå®šä¹‰æ‰¹é‡
â”œâ”€â”€ [5] ä»…åˆ†æ
â”œâ”€â”€ [6] ä»…å¯è§†åŒ–
â”œâ”€â”€ [7] æŸ¥çœ‹å¯ç”¨ GPU
â”œâ”€â”€ [8] è®¾ç½®è®­ç»ƒè½®æ•°
â”œâ”€â”€ [9] è®¾ç½® GPU ID
â””â”€â”€ [0] é€€å‡º
```

### 1.2 å…·ä½“ç—›ç‚¹

| ç—›ç‚¹ | é—®é¢˜æè¿° | å½±å“ |
|------|----------|------|
| è®­ç»ƒæ¨¡å¼æ··ä¹± | å•æ¬¡/LOSO/æ‰¹é‡/è‡ªå®šä¹‰æ‰¹é‡ å››ç§æ¨¡å¼åŒºåˆ†ä¸æ¸… | ç”¨æˆ·ä¸çŸ¥é“è¯¥é€‰å“ªä¸ª |
| LOSO è¯´æ˜ç¼ºå¤± | "è¿è¡Œå•ä¸ª fold" vs "è¿è¡Œæ‰€æœ‰ folds" æ²¡æœ‰è§£é‡Š | æ–°ç”¨æˆ·å®Œå…¨ä¸ç†è§£ |
| GPU ä¿¡æ¯è¿‡è½½ | ç›´æ¥æ‰“å° `nvidia-smi` åŸå§‹è¾“å‡º | ä¿¡æ¯å†—ä½™ï¼Œéš¾ä»¥é˜…è¯» |
| GPU é€‰æ‹©ç›²è¾“ | åªèƒ½æ‰‹åŠ¨è¾“å…¥æ•°å­—ï¼Œæ— æ³•çœ‹åˆ°åˆ—è¡¨é€‰æ‹© | å®¹æ˜“å‡ºé”™ |
| å‚æ•°è®¾ç½®å•ä¸€ | åªèƒ½ä¿®æ”¹ Epochs | æ— æ³•è°ƒæ•´ batch_sizeã€learning_rate ç­‰ |

---

## 2. æ–°æ¶æ„è®¾è®¡

### 2.1 è®¾è®¡åŸåˆ™

1. **ä»»åŠ¡å¯¼å‘**ï¼šæŒ‰"æˆ‘è¦åšä»€ä¹ˆ"ç»„ç»‡èœå•ï¼Œè€ŒéæŒ‰åŠŸèƒ½æ¨¡å—
2. **é…ç½®ä¼˜å…ˆ**ï¼šå…ˆå®Œæˆé…ç½®ï¼Œå†æ‰§è¡Œä»»åŠ¡
3. **ä¸Šä¸‹æ–‡å¸®åŠ©**ï¼šå…³é”®é€‰é¡¹æä¾›ç®€çŸ­è¯´æ˜
4. **æ¸è¿›å¼å¤æ‚åº¦**ï¼šå¸¸ç”¨åŠŸèƒ½ç®€å•ç›´è¾¾ï¼Œé«˜çº§åŠŸèƒ½å¯é€‰å±•å¼€

### 2.2 æ–°èœå•å±‚çº§ç»“æ„

```
ä¸»èœå•
â”‚
â”œâ”€â”€ [1] ğŸš€ å¿«é€Ÿå¼€å§‹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       ä¸€é”®è¿è¡Œå•æ¬¡å®éªŒï¼Œä½¿ç”¨å½“å‰é…ç½®
â”‚
â”œâ”€â”€ [2] âš™ï¸ å®éªŒé…ç½® â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚
â”‚       â”œâ”€â”€ [2.1] æŸ¥çœ‹å½“å‰é…ç½®
â”‚       â”‚         æ˜¾ç¤ºæ‰€æœ‰å‚æ•°çš„å½“å‰å€¼
â”‚       â”‚
â”‚       â”œâ”€â”€ [2.2] æ¨¡å‹ä¸æ•°æ®
â”‚       â”‚         â”œâ”€â”€ é€‰æ‹©æ¨¡å‹: EEGNet / Conformer
â”‚       â”‚         â””â”€â”€ é€‰æ‹©æ•°æ®é›†: BCI2a / BCI2b
â”‚       â”‚
â”‚       â”œâ”€â”€ [2.3] éšæœºå…±æŒ¯è®¾ç½®
â”‚       â”‚         â”œâ”€â”€ é€‰æ‹©æœºåˆ¶: Additive / Bistable / Tristable
â”‚       â”‚         â””â”€â”€ é€‰æ‹©å™ªå£°: Gaussian / Uniform / Alpha-Stable / ...
â”‚       â”‚
â”‚       â”œâ”€â”€ [2.4] è®­ç»ƒå‚æ•°
â”‚       â”‚         â”œâ”€â”€ Epochs: 50
â”‚       â”‚         â”œâ”€â”€ Batch Size: 32
â”‚       â”‚         â”œâ”€â”€ Learning Rate: 0.001
â”‚       â”‚         â””â”€â”€ Early Stopping Patience: 10
â”‚       â”‚
â”‚       â”œâ”€â”€ [2.5] GPU è®¾ç½®
â”‚       â”‚         æ˜¾ç¤º GPU åˆ—è¡¨ï¼Œç®­å¤´/æ•°å­—é€‰æ‹©
â”‚       â”‚
â”‚       â””â”€â”€ [2.0] â† è¿”å›ä¸»èœå•
â”‚
â”œâ”€â”€ [3] ğŸ”¬ è¿è¡Œå®éªŒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚
â”‚       â”œâ”€â”€ [3.1] æ ‡å‡†è®­ç»ƒ
â”‚       â”‚         ä½¿ç”¨å›ºå®šè®­ç»ƒ/æµ‹è¯•é›†åˆ’åˆ†è¿›è¡Œå•æ¬¡è®­ç»ƒ
â”‚       â”‚         é€‚ç”¨äºï¼šå¿«é€ŸéªŒè¯ã€è°ƒå‚ã€åŸå‹å¼€å‘
â”‚       â”‚
â”‚       â”œâ”€â”€ [3.2] LOSO äº¤å‰éªŒè¯
â”‚       â”‚         Leave-One-Subject-Out: ç•™ä¸€è¢«è¯•ä½œä¸ºæµ‹è¯•é›†
â”‚       â”‚         é€‚ç”¨äºï¼šè¯„ä¼°æ¨¡å‹çš„è·¨è¢«è¯•æ³›åŒ–èƒ½åŠ›
â”‚       â”‚         â”‚
â”‚       â”‚         â”œâ”€â”€ è¿è¡ŒæŒ‡å®š Fold: åªè®­ç»ƒä¸€ä¸ªè¢«è¯•ä½œä¸ºæµ‹è¯•é›†
â”‚       â”‚         â””â”€â”€ è¿è¡Œå…¨éƒ¨ Folds: ä¾æ¬¡ç”¨æ¯ä¸ªè¢«è¯•åšæµ‹è¯• (å…±9æŠ˜)
â”‚       â”‚
â”‚       â”œâ”€â”€ [3.3] æ‰¹é‡å®éªŒ
â”‚       â”‚         è‡ªåŠ¨éå†å¤šç§é…ç½®ç»„åˆ
â”‚       â”‚         â”‚
â”‚       â”‚         â”œâ”€â”€ å…¨ç»„åˆæ¨¡å¼: æ‰€æœ‰å¯èƒ½çš„å‚æ•°ç»„åˆ
â”‚       â”‚         â””â”€â”€ è‡ªå®šä¹‰æ¨¡å¼: é€‰æ‹©è¦éå†çš„å‚æ•°
â”‚       â”‚
â”‚       â””â”€â”€ [3.0] â† è¿”å›ä¸»èœå•
â”‚
â”œâ”€â”€ [4] ğŸ“Š åˆ†æä¸å¯è§†åŒ– â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚
â”‚       â”œâ”€â”€ [4.1] åˆ†æå·²è®­ç»ƒæ¨¡å‹
â”‚       â”‚         é€‰æ‹©æ£€æŸ¥ç‚¹ â†’ è¿è¡Œå™ªå£°æ‰«æåˆ†æ
â”‚       â”‚
â”‚       â”œâ”€â”€ [4.2] ç”Ÿæˆå¯è§†åŒ–å›¾è¡¨
â”‚       â”‚         â”œâ”€â”€ è®­ç»ƒæ›²çº¿
â”‚       â”‚         â”œâ”€â”€ æ··æ·†çŸ©é˜µ
â”‚       â”‚         â””â”€â”€ å™ªå£°-æ€§èƒ½æ›²çº¿
â”‚       â”‚
â”‚       â””â”€â”€ [4.0] â† è¿”å›ä¸»èœå•
â”‚
â”œâ”€â”€ [5] â„¹ï¸ å¸®åŠ© â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       æ˜¾ç¤ºå„åŠŸèƒ½çš„è¯¦ç»†è¯´æ˜
â”‚
â””â”€â”€ [0] é€€å‡º
```

---

## 3. æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 3.1 å…¨å±€é…ç½®çŠ¶æ€

```python
@dataclass
class ExperimentConfig:
    # æ¨¡å‹ä¸æ•°æ®
    model: str = "conformer"
    dataset: str = "bci2a"
    
    # éšæœºå…±æŒ¯
    mechanism: str = "additive"
    noise_type: str = "gaussian"
    
    # è®­ç»ƒå‚æ•°
    epochs: int = 50
    batch_size: int = 32
    learning_rate: float = 0.001
    early_stopping_patience: int = 10
    
    # ç¡¬ä»¶
    gpu_id: int = 0
    use_cpu: bool = False
```

### 3.2 GPU é€‰æ‹©æ¨¡å—

**ç›®æ ‡**ï¼šè§£æç³»ç»Ÿ GPU ä¿¡æ¯ï¼Œæ˜¾ç¤ºç®€æ´åˆ—è¡¨ï¼Œæ”¯æŒäº¤äº’é€‰æ‹©

**äº¤äº’ç¤ºä¾‹**ï¼š
```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  GPU è®¾ç½®
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

å¯ç”¨è®¾å¤‡:

  ID   åç§°                          æ˜¾å­˜        ä½¿ç”¨ç‡
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  [0]  NVIDIA GeForce RTX 3090       24.0 GB     12%
  [1]  NVIDIA GeForce RTX 3080       10.0 GB     45%
  [C]  CPU æ¨¡å¼ï¼ˆä¸ä½¿ç”¨ GPUï¼‰

å½“å‰é€‰æ‹©: GPU 0

è¯·é€‰æ‹©è®¾å¤‡ [0/1/C] (ç›´æ¥å›è½¦ä¿æŒå½“å‰): 
```

**å®ç°æ€è·¯**ï¼š
```python
def parse_gpu_info() -> List[GPUInfo]:
    """è§£æ GPU ä¿¡æ¯ï¼Œè¿”å›ç»“æ„åŒ–æ•°æ®"""
    gpus = []
    
    # æ–¹å¼1: ä½¿ç”¨ pynvml (æ¨è)
    try:
        import pynvml
        pynvml.nvmlInit()
        count = pynvml.nvmlDeviceGetCount()
        for i in range(count):
            handle = pynvml.nvmlDeviceGetHandleByIndex(i)
            name = pynvml.nvmlDeviceGetName(handle)
            mem_info = pynvml.nvmlDeviceGetMemoryInfo(handle)
            util = pynvml.nvmlDeviceGetUtilizationRates(handle)
            gpus.append(GPUInfo(
                id=i,
                name=name,
                memory_total=mem_info.total / 1e9,
                memory_used=mem_info.used / 1e9,
                utilization=util.gpu
            ))
        return gpus
    except ImportError:
        pass
    
    # æ–¹å¼2: è§£æ nvidia-smi è¾“å‡º
    # ... å¤‡é€‰æ–¹æ¡ˆ
    
    # æ–¹å¼3: PyTorch fallback
    # ... ä»…è·å–åŸºæœ¬ä¿¡æ¯
```

### 3.3 å‚æ•°é…ç½®æ¨¡å—

**ç›®æ ‡**ï¼šå…è®¸æŸ¥çœ‹å’Œä¿®æ”¹æ‰€æœ‰å…³é”®è®­ç»ƒå‚æ•°

**äº¤äº’ç¤ºä¾‹**ï¼š
```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  è®­ç»ƒå‚æ•°é…ç½®
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  åºå·   å‚æ•°å                 å½“å‰å€¼        è¯´æ˜
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  [1]    Epochs                 50           æœ€å¤§è®­ç»ƒè½®æ•°
  [2]    Batch Size             32           æ¯æ‰¹æ ·æœ¬æ•°
  [3]    Learning Rate          0.001        åˆå§‹å­¦ä¹ ç‡
  [4]    Early Stopping         10           æå‰åœæ­¢è€å¿ƒå€¼

  [R]    é‡ç½®ä¸ºé»˜è®¤å€¼
  [0]    â† è¿”å›

è¯·é€‰æ‹©è¦ä¿®æ”¹çš„å‚æ•°: 2
è¯·è¾“å…¥æ–°çš„ Batch Size [å½“å‰: 32]: 64
âœ“ Batch Size å·²æ›´æ–°ä¸º 64
```

**å®ç°æ€è·¯**ï¼š
```python
# å‚æ•°å®šä¹‰ï¼ˆä¾¿äºæ‰©å±•ï¼‰
CONFIGURABLE_PARAMS = {
    "epochs": {
        "display_name": "Epochs",
        "description": "æœ€å¤§è®­ç»ƒè½®æ•°",
        "type": int,
        "default": 50,
        "range": (1, 1000)
    },
    "batch_size": {
        "display_name": "Batch Size",
        "description": "æ¯æ‰¹æ ·æœ¬æ•°",
        "type": int,
        "default": 32,
        "choices": [16, 32, 64, 128, 256]
    },
    "learning_rate": {
        "display_name": "Learning Rate",
        "description": "åˆå§‹å­¦ä¹ ç‡",
        "type": float,
        "default": 0.001,
        "range": (1e-6, 1.0)
    },
    # ... æ›´å¤šå‚æ•°
}
```

### 3.4 LOSO äº¤å‰éªŒè¯æ¨¡å—

**ç›®æ ‡**ï¼šæ¸…æ™°è§£é‡Š LOSO æ¦‚å¿µï¼Œå¼•å¯¼ç”¨æˆ·é€‰æ‹©

**äº¤äº’ç¤ºä¾‹**ï¼š
```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  LOSO äº¤å‰éªŒè¯
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ä»€ä¹ˆæ˜¯ LOSOï¼Ÿ
  Leave-One-Subject-Outï¼ˆç•™ä¸€è¢«è¯•æ³•ï¼‰æ˜¯ä¸€ç§äº¤å‰éªŒè¯ç­–ç•¥ã€‚
  æ•°æ®é›†ä¸­æœ‰ 9 ä¸ªè¢«è¯•ï¼Œæ¯æ¬¡ç”¨ 1 ä¸ªè¢«è¯•çš„æ•°æ®åšæµ‹è¯•ï¼Œ
  å…¶ä½™ 8 ä¸ªè¢«è¯•çš„æ•°æ®åšè®­ç»ƒã€‚é‡å¤ 9 æ¬¡å¾—åˆ°å¹³å‡æ€§èƒ½ã€‚

è¿è¡Œæ¨¡å¼:

  [1] è¿è¡Œå•ä¸ª Fold
      åªç”¨æŒ‡å®šçš„ä¸€ä¸ªè¢«è¯•åšæµ‹è¯•é›†ï¼Œå¿«é€ŸéªŒè¯
      
  [2] è¿è¡Œå…¨éƒ¨ 9 ä¸ª Folds
      å®Œæ•´çš„ LOSO è¯„ä¼°ï¼Œè·å¾—ç»Ÿè®¡æ˜¾è‘—çš„ç»“æœ
      âš ï¸ é¢„è®¡éœ€è¦è¿è¡Œ 9 æ¬¡å®Œæ•´è®­ç»ƒ

  [0] â† è¿”å›

è¯·é€‰æ‹©: 1

é€‰æ‹©æµ‹è¯•è¢«è¯• (Fold ID):
  [1] Subject 1    [4] Subject 4    [7] Subject 7
  [2] Subject 2    [5] Subject 5    [8] Subject 8
  [3] Subject 3    [6] Subject 6    [9] Subject 9

è¯·è¾“å…¥ Fold ID [1-9]: 
```

### 3.5 å¿«é€Ÿå¼€å§‹æ¨¡å—

**ç›®æ ‡**ï¼šä¸€é”®è¿è¡Œï¼Œæ˜¾ç¤ºå½“å‰é…ç½®æ‘˜è¦

**äº¤äº’ç¤ºä¾‹**ï¼š
```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ğŸš€ å¿«é€Ÿå¼€å§‹
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

å½“å‰å®éªŒé…ç½®æ‘˜è¦:

  æ¨¡å‹        EEG Conformer
  æ•°æ®é›†      BCI Competition IV 2a (4ç±»)
  SR æœºåˆ¶     Additive (åŠ æ€§)
  å™ªå£°ç±»å‹    Gaussian (é«˜æ–¯)
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  è®­ç»ƒè½®æ•°    50 epochs
  æ‰¹å¤§å°      32
  å­¦ä¹ ç‡      0.001
  GPU         #0 (RTX 3090)

å®éªŒåç§°: conformer_bci2a_additive_gaussian
è¾“å‡ºç›®å½•: ./results/conformer_bci2a_additive_gaussian/

æŒ‰ [Enter] å¼€å§‹è®­ç»ƒï¼Œ[C] è¿›å…¥é…ç½®ä¿®æ”¹ï¼Œ[0] è¿”å›: 
```

---

## 4. äº¤äº’æµç¨‹å›¾

### 4.1 æ ‡å‡†å®éªŒæµç¨‹

```mermaid
flowchart TD
    A[ä¸»èœå•] --> B{ç”¨æˆ·é€‰æ‹©}
    B -->|å¿«é€Ÿå¼€å§‹| C[æ˜¾ç¤ºå½“å‰é…ç½®]
    B -->|å®éªŒé…ç½®| D[é…ç½®å­èœå•]
    B -->|è¿è¡Œå®éªŒ| E[é€‰æ‹©å®éªŒç±»å‹]
    
    C --> C1{ç¡®è®¤?}
    C1 -->|æ˜¯| F[æ‰§è¡Œè®­ç»ƒ]
    C1 -->|ä¿®æ”¹| D
    
    D --> D1[æ¨¡å‹ä¸æ•°æ®]
    D --> D2[SR è®¾ç½®]
    D --> D3[è®­ç»ƒå‚æ•°]
    D --> D4[GPU è®¾ç½®]
    D1 & D2 & D3 & D4 --> A
    
    E --> E1[æ ‡å‡†è®­ç»ƒ]
    E --> E2[LOSO éªŒè¯]
    E --> E3[æ‰¹é‡å®éªŒ]
    
    E1 --> F
    E2 --> G{å•Fold/å…¨éƒ¨?}
    G -->|å• Fold| H[é€‰æ‹© Fold ID]
    G -->|å…¨éƒ¨| I[ä¾æ¬¡è¿è¡Œ 9 æŠ˜]
    H --> F
    I --> F
    
    F --> J[è®­ç»ƒå®Œæˆ]
    J --> K{ç»§ç»­åˆ†æ?}
    K -->|æ˜¯| L[è‡ªåŠ¨è¿è¡Œåˆ†æ]
    K -->|å¦| A
    L --> A
```

### 4.2 é…ç½®ä¿®æ”¹æµç¨‹

```mermaid
flowchart LR
    A[é…ç½®èœå•] --> B[æŸ¥çœ‹å½“å‰é…ç½®]
    A --> C[é€‰æ‹©é…ç½®é¡¹]
    C --> D[è¾“å…¥æ–°å€¼]
    D --> E{éªŒè¯}
    E -->|æœ‰æ•ˆ| F[æ›´æ–°é…ç½®]
    E -->|æ— æ•ˆ| G[æ˜¾ç¤ºé”™è¯¯æç¤º]
    G --> D
    F --> A
```

---

## 5. UI ç»„ä»¶è®¾è®¡

### 5.1 è¡¨æ ¼æ˜¾ç¤ºå™¨

ç”¨äºå±•ç¤ºé…ç½®åˆ—è¡¨ã€GPU åˆ—è¡¨ç­‰ï¼š

```python
def print_table(headers: List[str], rows: List[List[str]], 
                highlight_row: int = None):
    """æ‰“å°æ ¼å¼åŒ–è¡¨æ ¼"""
    # è®¡ç®—åˆ—å®½
    col_widths = [max(len(str(cell)) for cell in col) 
                  for col in zip(headers, *rows)]
    
    # æ‰“å°è¡¨å¤´
    header_line = "  ".join(h.ljust(w) for h, w in zip(headers, col_widths))
    print(f"  {header_line}")
    print("  " + "â”€" * sum(col_widths + [2 * (len(headers) - 1)]))
    
    # æ‰“å°è¡Œ
    for i, row in enumerate(rows):
        line = "  ".join(str(c).ljust(w) for c, w in zip(row, col_widths))
        if i == highlight_row:
            print(f"  {line}  â† å½“å‰")
        else:
            print(f"  {line}")
```

### 5.2 é…ç½®æ‘˜è¦å¡ç‰‡

```python
def print_config_card(config: ExperimentConfig):
    """æ‰“å°é…ç½®æ‘˜è¦å¡ç‰‡"""
    print()
    print("  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”")
    print(f"  â”‚ æ¨¡å‹        {config.model:<24}â”‚")
    print(f"  â”‚ æ•°æ®é›†      {config.dataset:<24}â”‚")
    print("  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤")
    print(f"  â”‚ SR æœºåˆ¶     {config.mechanism:<24}â”‚")
    print(f"  â”‚ å™ªå£°ç±»å‹    {config.noise_type:<24}â”‚")
    print("  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤")
    print(f"  â”‚ Epochs      {config.epochs:<24}â”‚")
    print(f"  â”‚ Batch Size  {config.batch_size:<24}â”‚")
    print(f"  â”‚ GPU         #{config.gpu_id:<23}â”‚")
    print("  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜")
```

### 5.3 è¿›åº¦æŒ‡ç¤ºå™¨

```python
def print_step_progress(current: int, total: int, description: str):
    """æ‰“å°æ­¥éª¤è¿›åº¦"""
    bar_length = 30
    filled = int(bar_length * current / total)
    bar = "â–ˆ" * filled + "â–‘" * (bar_length - filled)
    print(f"\r  [{bar}] {current}/{total} {description}", end="", flush=True)
```

---

## 6. å…³é”®åŠŸèƒ½å®ç°è¦ç‚¹

### 6.1 é…ç½®æŒä¹…åŒ–

```python
CONFIG_FILE = Path.home() / ".sr_eeg_config.json"

def save_config(config: ExperimentConfig):
    """ä¿å­˜é…ç½®åˆ°ç”¨æˆ·ç›®å½•"""
    with open(CONFIG_FILE, "w") as f:
        json.dump(asdict(config), f, indent=2)

def load_config() -> ExperimentConfig:
    """åŠ è½½é…ç½®ï¼Œå¦‚ä¸å­˜åœ¨åˆ™è¿”å›é»˜è®¤å€¼"""
    if CONFIG_FILE.exists():
        with open(CONFIG_FILE) as f:
            return ExperimentConfig(**json.load(f))
    return ExperimentConfig()
```

### 6.2 GPU ä¿¡æ¯ç¼“å­˜

```python
_gpu_cache: Optional[List[GPUInfo]] = None
_gpu_cache_time: float = 0

def get_gpu_list(refresh: bool = False) -> List[GPUInfo]:
    """è·å– GPU åˆ—è¡¨ï¼Œå¸¦ç¼“å­˜"""
    global _gpu_cache, _gpu_cache_time
    
    if not refresh and _gpu_cache and (time.time() - _gpu_cache_time < 30):
        return _gpu_cache
    
    _gpu_cache = parse_gpu_info()
    _gpu_cache_time = time.time()
    return _gpu_cache
```

### 6.3 è¾“å…¥éªŒè¯

```python
def get_validated_input(prompt: str, validator: Callable, 
                        error_msg: str, default=None):
    """å¸¦éªŒè¯çš„è¾“å…¥è·å–"""
    while True:
        raw = input(prompt).strip()
        if not raw and default is not None:
            return default
        
        try:
            value = validator(raw)
            return value
        except ValueError:
            print(f"  âš ï¸ {error_msg}")
```

---

## 7. æ–‡ä»¶ç»“æ„å»ºè®®

```
scripts/
â”œâ”€â”€ menu.py                 # ä¸»å…¥å£ï¼Œèœå•å¾ªç¯
â”œâ”€â”€ menu/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ config.py           # ExperimentConfig ç±»
â”‚   â”œâ”€â”€ ui.py               # UI ç»„ä»¶ï¼ˆè¡¨æ ¼ã€å¡ç‰‡ã€è¿›åº¦æ¡ï¼‰
â”‚   â”œâ”€â”€ gpu.py              # GPU æ£€æµ‹ä¸é€‰æ‹©
â”‚   â”œâ”€â”€ experiments.py      # å®éªŒè¿è¡Œé€»è¾‘
â”‚   â””â”€â”€ help.py             # å¸®åŠ©æ–‡æœ¬
```

---

## 8. åç»­æ‰©å±•ç‚¹

1. **é…ç½®é¢„è®¾**ï¼šä¿å­˜/åŠ è½½å¸¸ç”¨é…ç½®ç»„åˆ
2. **å®éªŒé˜Ÿåˆ—**ï¼šæ‰¹é‡ä»»åŠ¡æ’é˜Ÿæ‰§è¡Œ
3. **è¿œç¨‹ç›‘æ§**ï¼šè®­ç»ƒçŠ¶æ€æ¨é€é€šçŸ¥
4. **å†å²è®°å½•**ï¼šè‡ªåŠ¨è®°å½•æ¯æ¬¡å®éªŒçš„é…ç½®ä¸ç»“æœ

---

## 9. å®æ–½è®¡åˆ’

| æ­¥éª¤ | å†…å®¹ | ä¾èµ– |
|------|------|------|
| 1 | åˆ›å»º `ExperimentConfig` æ•°æ®ç±» | æ—  |
| 2 | å®ç° GPU è§£ææ¨¡å— | æ—  |
| 3 | å®ç° UI ç»„ä»¶åº“ | æ—  |
| 4 | é‡æ„ä¸»èœå•ç»“æ„ | 1, 3 |
| 5 | å®ç°é…ç½®å­èœå• | 1, 3 |
| 6 | å®ç° GPU é€‰æ‹©äº¤äº’ | 2, 3 |
| 7 | å®ç° LOSO æ¨¡å—ï¼ˆå¸¦å¸®åŠ©æ–‡æœ¬ï¼‰ | 4 |
| 8 | å®ç°å¿«é€Ÿå¼€å§‹åŠŸèƒ½ | 4, 5 |
| 9 | æ·»åŠ é…ç½®æŒä¹…åŒ– | 1 |
| 10 | æµ‹è¯•ä¸è°ƒä¼˜ | 1-9 |
